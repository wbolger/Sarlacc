
require(['jquery','mw','wikia.window','wikia.geo','wikia.cache','wikia.tracker','BannerNotification'],function($,mw,w,geo,cache,tracker,BannerNotification){'use strict';var targetLanguage=getTargetLanguage(),contentLanguage=w.wgContentLanguage.split('-')[0],cacheVersion='1.01';function init(){if(targetLanguage!==false&&targetLanguage!==contentLanguage){if(cache.get('wikiaInYourLangRequestSent'+cacheVersion)!==true&&cache.get('wikiaInYourLangNotificationShown'+cacheVersion)!==true){cache.set('wikiaInYourLangRequestSent'+cacheVersion,true,cache.CACHE_STANDARD);getNativeWikiaInfo();}else if(typeof cache.get(targetLanguage+'WikiaInYourLangMessage'+cacheVersion)==='string'){displayNotification(cache.get(targetLanguage+'WikiaInYourLangMessage'+cacheVersion));}}}
function getTargetLanguage(){var browserLanguage=window.navigator.language||window.navigator.userLanguage,geoCountryCode=geo.getCountryCode().toLowerCase(),targetLanguage;if(w.wgUserName!==null){targetLanguage=w.wgUserLanguage;}else if(typeof browserLanguage==='string'){targetLanguage=browserLanguage.split('-')[0];}else if(typeof geoCountryCode==='string'){targetLanguage=geoCountryCode;}else{targetLanguage=false;}
return targetLanguage.split('-')[0];}
function getNativeWikiaInfo(){$.nirvana.sendRequest({controller:'WikiaInYourLangController',method:'getNativeWikiaInfo',format:'json',type:'GET',data:{targetLanguage:targetLanguage},callback:function(results){if(results.success===true){displayNotification(results.message);cache.set(targetLanguage+'WikiaInYourLangMessage'+cacheVersion,results.message,cache.CACHE_STANDARD);}}});}
function displayNotification(message){var bannerNotification=new BannerNotification(message,'notify').show(),trackingParams={trackingMethod:'analytics',category:'wikia-in-your-lang',action:tracker.ACTIONS.VIEW,label:targetLanguage+'-notification-view'};tracker.track(trackingParams);bindEvents(bannerNotification);}
function bindEvents(bannerNotification){bannerNotification.onClose(onNotificationClosed);bannerNotification.$element.on('click','.text',onLinkClick);}
function onNotificationClosed(){var trackingParams={trackingMethod:'analytics',category:'wikia-in-your-lang',action:tracker.ACTIONS.CLOSE,label:targetLanguage+'-notification-close',};tracker.track(trackingParams);cache.set(targetLanguage+'WikiaInYourLangMessage'+cacheVersion,null);cache.set('wikiaInYourLangNotificationShown'+cacheVersion,true,cache.CACHE_LONG);}
function onLinkClick(){var trackingParams={trackingMethod:'analytics',category:'wikia-in-your-lang',action:tracker.ACTIONS.CLICK_LINK_TEXT,label:targetLanguage+'-notification-link-click',};tracker.track(trackingParams);}
if(!w.wikiaPageIsCorporate){$(init);}});;